YUI.add("flickr-photos-deleteNote-deletor",function(e,t){"use strict";function n(n,r){var i={};return i.note_id=n,r.callAPI("flickr.photos.notes.delete",i).then(null,e.FetcherErrorLogger(t))}e.namespace("ModelDeletors")["flickr-photos-deleteNote"]={run:n}},"@VERSION@",{requires:["flickr-promise"],optional:[]});
YUI.add("note-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{create:function(t){return e.ModelCreators["flickr-photos-addNotes"].run(t,this.appContext)},update:function(t,n){var r;return r={noteId:t,noteX:this.getValue(t,"left"),noteY:this.getValue(t,"top"),noteW:this.getValue(t,"width"),noteH:this.getValue(t,"height"),noteText:this.getValue(t,"text")},e.ModelUpdaters["flickr-photos-editNote"].run(r,this.appContext)},"delete":function(t){return e.ModelDeletors["flickr-photos-deleteNote"].run(t,this.appContext)}},attributes:{authorName:{setter:function(e){return e}},author:{setter:function(e){return e}},left:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)}},top:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)}},width:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)}},height:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)}},text:{setter:function(e){return e}}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-photos-addNotes-creator","flickr-photos-editNote-updater","flickr-photos-deleteNote-deletor","attribute-helpers"]});
YUI.add("flickr-photos-deleteAutotags-deletor",function(e,t){"use strict";function n(n,r){return r.callAPI("flickr.photos.deleteAutotags",n).then(null,e.FetcherErrorLogger(t))}e.namespace("ModelDeletors")["flickr-photos-deleteAutotags"]={run:n}},"@VERSION@",{requires:["flickr-promise"],optional:[]});
YUI.add("autotag-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{"delete":function(t){return e.ModelDeletors["flickr-photos-deleteAutotags"].run(t,this.appContext)}},attributes:{autotagValue:{validator:function(t){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)}},score:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)}},isPrivate:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},searchUrl:{derivedBy:["autotagValue"],readOnly:!0,defaultFn:function(e){var t=this.getValue(e,"autotagValue");return"/search/?q="+t}}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-photos-deleteAutotags-deletor"]});
YUI.add("photo-autotags-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{"delete":function(t){return e.ModelDeletors["flickr-photos-deleteAutotags"].run(t,this.appContext)}},attributes:{autotags:{isCollection:!0}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-photos-deleteAutotags-deletor"]});
YUI.add("flickr-photos-getInfo-fetcher",function(e,t){"use strict";function n(t){var n,r;return n=["sizes","icon_urls","ignored","rev_ignored","venue","datecreate"].join(","),n=n+","+e.APIHelper.request.getRebootPhotoExtras(),r={datecreate:1,extras:n,photo_id:t.id,get_contexts:1,primary_photo_extras:"url_sq, url_t, url_s, url_m"},t.userId?r.user_id=t.userId:t.pathAlias&&(r.path_alias=t.pathAlias),t.context&&(r.context=t.context,r.num_prev=1,r.num_next=1),t.scrappy&&(e.APIHelper.request.addStaticMapsParams(r),delete r.get_contexts,delete r.primary_photo_extras,delete r.context),r}function r(t,n,r){var s=t.apiResponse,o=t.photoRegistry,u=t.personRegistry,a=t.personRelationshipRegistry,f=t.photoEngagementRegistry,l=t.photoStatsRegistry,c=t.photoPrivacyRegistry,h=t.photoNotesRegistry,p=t.noteRegistry,d=t.photoGeoRegistry,v=t.photoLocationRegistry,m=t.photoHeadMetaRegistry,g=t.groupRegistry,y,b={},w,E,S,x,T,N,C=[],k,L,A;w={id:s.photo.id,title:s.photo.title.content,description:s.photo.description.content,sizes:e.APIHelper.response.parsePhotoSize(s.photo.sizes.size,!0),needsInterstitial:s.photo.needsInterstitial,canComment:s.photo.editability.cancomment,canPublicComment:s.photo.publiceditability.cancomment,canAddMeta:s.photo.editability.canaddmeta,safetyLevel:s.photo.safetyLevel,license:s.photo.license,mediaType:s.photo.media,secret:s.photo.secret,isHD:e.APIHelper.response.isHD(s.photo.sizes.size),rotation:s.photo.rotation,hasInvalidColorspaceForPrint:s.photo.hasInvalidColorspaceForPrint,isMarketplacePrintable:s.photo.isMarketplacePrintable,isMarketplaceLicensable:s.photo.isMarketplaceLicensable?s.photo.isMarketplaceLicensable:!1,marketplaceLicensingUrl:s.photo.marketplaceLicensingUrl?s.photo.marketplaceLicensingUrl:"",oWidth:s.photo.oWidth?parseInt(s.photo.oWidth,10):"",oHeight:s.photo.oHeight?parseInt(s.photo.oHeight,10):"",visibilitySource:s.photo.visibilitySource},E={id:s.photo.owner.nsid,username:s.photo.owner.username,realname:s.photo.owner.realname,pathAlias:s.photo.owner.pathAlias,buddyicon:e.APIHelper.response.agnosticizeFarmPathTransferProtocol(s.photo.owner.iconurls),isAdFree:s.photo.owner.isAdFree,isPro:s.photo.owner.ispro,dateCreated:s.photo.owner.datecreate,location:s.photo.owner.location},S={id:s.photo.owner.nsid,pathAlias:s.photo.owner.pathAlias,isContact:s.photo.contactIscontact,isFamily:s.photo.contactIsfamily,isFriend:s.photo.contactIsfriend,isIgnored:s.photo.owner.isignored,isIgnoredBy:s.photo.owner.revIgnored},x={id:s.photo.id,ownerNsid:s.photo.owner.nsid,isFaved:s.photo.isfavorite||!1,canShare:s.photo.usage.canshare,canDownload:s.photo.usage.candownload,commentCount:s.photo.comments.content,noteCount:s.photo.notes&&s.photo.notes.note&&s.photo.notes.note.length,faveCount:s.photo.countFaves,viewCount:s.photo.views},T={id:s.photo.id,dateTaken:s.photo.dates.taken,datePosted:s.photo.dates.posted,takenGranularity:s.photo.dates.takengranularity,isDateTakenUnknown:s.photo.datetakenunknown||s.photo.datetakenunknown==="1"||s.photo.datetakenunknown===1},k={id:s.photo.id,title:s.photo.HTMLMETA["og:title"],noindexfollow:s.photo.owner.noindexfollow,keywords:s.photo.HTMLMETA.keywords,"og:title":s.photo.HTMLMETA["og:title"],"og:description":s.photo.HTMLMETA["og:description"],"og:type":s.photo.HTMLMETA["og:type"],"og:url":s.photo.HTMLMETA["og:url"],"og:image":s.photo.HTMLMETA["og:image"],"og:image:width":s.photo.HTMLMETA["og:image:width"],"og:image:height":s.photo.HTMLMETA["og:image:height"],"flickr_photos:by":s.photo.HTMLMETA["flickr_photos:by"],"flickr_photos:camera":s.photo.HTMLMETA["flickr_photos:camera"],"flickr_photos:sets":s.photo.HTMLMETA["flickr_photos:sets"],"flickr_photos:groups":s.photo.HTMLMETA["flickr_photos:groups"],"flickr_photos:galleries":s.photo.HTMLMETA["flickr_photos:galleries"],"twitter:card":s.photo.HTMLMETA["twitter:card"],"twitter:description":s.photo.HTMLMETA["twitter:description"],"twitter:app:url:iphone":s.photo.HTMLMETA["twitter:app:url:iphone"],"twitter:creator":s.photo.HTMLMETA["twitter:creator"],pinterest:s.photo.HTMLMETA.pinterest},N={id:s.photo.id,isPublic:s.photo.visibility.ispublic,isVisibleByFriends:s.photo.visibility.isfriend,isVisibleByFamily:s.photo.visibility.isfamily,permAddMeta:s.photo.permissions?s.photo.permissions.permaddmeta:0,permComment:s.photo.permissions?s.photo.permissions.permcomment:0},s.photo&&s.photo.notes&&s.photo.notes.note&&e.Array(s.photo.notes.note).forEach(function(e){C.push(p.addOrUpdate({id:e.id,authorName:e.authorname,author:e.author,left:e.x,top:e.y,width:e.w,height:e.h,text:e.content}))}),L=e.ModelFetchers["flickr-photos-getLocation"].mapResponse(s,d),w.owner=u.addOrUpdate(E),w.engagement=f.addOrUpdate(x),a.addOrUpdate(S),A=o.addOrUpdate(w),s.photo.isMarketplacePrintable&&A.setValue("isMarketplacePrintable",!0),s.photo.isMarketplaceLicensable&&A.setValue("isMarketplaceLicensable",!0),l.addOrUpdate(T),c.addOrUpdate(N),h.addOrUpdate({id:w.id,notes:C}),m.addOrUpdate(k),v.addOrUpdate(L),s.photo.contexts&&(y=t.contextsRegistry,b.faves=t.favoriteRegistry,b.gallery=t.galleryRegistry,b.pool=t.groupsPoolRegistry,b.set=t.setRegistry,b.stream=t.photostreamRegistry,i({photoModel:A,contextRegistries:b,contextsResponse:s.photo.contexts,personRegistry:u,contextsRegistry:y,photoEngagementRegistry:f,photoStatsRegistry:l,groupRegistry:g,apiParams:r}))}function i(t){var n=t.photoModel,r=t.contextRegistries,i=t.contextsResponse,s=t.personRegistry,o=t.contextsRegistry,u=t.photoEngagementRegistry,a=t.photoStatsRegistry,f=t.photoCurationModelRegistry,l=t.groupRegistry,c=t.apiParams,h=[];e.Object.each(r,function(t,r){i[r]&&e.Array.each(i[r],function(r){e.APIHelper.response.addContextToRegistry(r,t,s,l),h.push(t.proxy(r.id)),c.context&&function(){var i,o,l,h,p,d,v,m,g;i=t.getValue(r.id,"photoContextList"),o=i.hasMinBoundary?i.hasMinBoundary():!1,l=i.hasMaxBoundary?i.hasMaxBoundary():!1,h=i.getList(),d=r.nextphotos,v=r.prevphotos,m=d?e.APIHelper.response.parsePhotos({photos:d.photo,personModelRegistry:s,photoModelRegistry:n.registry,photoEngagementModelRegistry
:u,photoStatsModelRegistry:a,photoCurationModelRegistry:f}):[],g=v?e.APIHelper.response.parsePhotos({photos:v.photo,personModelRegistry:s,photoModelRegistry:n.registry,photoEngagementModelRegistry:u,photoStatsModelRegistry:a,photoCurationModelRegistry:f}):[];if(g.length||m.length)p=e.APIHelper.response.addOrReplaceListByContext({model:n,next:m,prev:g.reverse(),current:h,hasMin:o,hasMax:l,numNext:c.num_next,numPrev:c.num_prev});t.setValue(r.id,"photoContextList",p)}()})}),o.exists(n.id)||(o.add({id:n.id,totalGroups:i.pool?i.pool.length:0,totalSets:i.set?i.set.length:0,totalGalleries:i.gallery?i.gallery.length:0}),o.setValue(n.id,"contexts",h))}function s(n,r){var i=this,s;return r.flipper.isFlipped("enable-scrappy-photo-page")&&(n.scrappy=!0),s=this._processParams(n),(new e.FlickrPromise({apiResponse:r.callAPI("flickr.photos.getInfo",s),photoRegistry:r.getModelRegistry("photo-models"),personRegistry:r.getModelRegistry("person-models"),personRelationshipRegistry:r.getModelRegistry("person-relationship-models"),photoEngagementRegistry:r.getModelRegistry("photo-engagement-models"),photoStatsRegistry:r.getModelRegistry("photo-stats-models"),photoCurationModelRegistry:r.getModelRegistry("photo-curation-models"),photoPrivacyRegistry:r.getModelRegistry("photo-privacy-models"),photoNotesRegistry:r.getModelRegistry("photo-notes-models"),noteRegistry:r.getModelRegistry("note-models"),photoGeoRegistry:r.getModelRegistry("photo-geo-models"),photoLocationRegistry:r.getModelRegistry("photo-location-models"),photoHeadMetaRegistry:r.getModelRegistry("photo-head-meta-models"),groupRegistry:r.getModelRegistry("group-models"),contextsRegistry:r.getModelRegistry("photo-contexts-models"),favoriteRegistry:r.getModelRegistry("favorite-models"),galleryRegistry:r.getModelRegistry("gallery-models"),groupsPoolRegistry:r.getModelRegistry("group-pool-models"),setRegistry:r.getModelRegistry("set-models"),photostreamRegistry:r.getModelRegistry("photostream-models")})).then(function(e){return i._processResponse(e,r.flipper,s)},e.FetcherErrorLogger(t))}e.namespace("ModelFetchers")["flickr-photos-getInfo"]={run:s,_processParams:n,_processResponse:r}},"@VERSION@",{requires:["flickr-promise","api-helper","flickr-photos-getLocation-fetcher"],optional:["photo-models","person-models","person-relationship-models","photo-engagement-models","photo-stats-models","photo-curation-models","photo-geo-models","photo-location-models","photo-head-meta-models","note-models","photo-notes-models","autotag-models","photo-autotags-models"]});
YUI.add("flickr-photos-setPerms-updater",function(e,t){"use strict";function n(e,t){var n=e[0],r=e[1],i;i=r.attributeSearch({normalizedId:t.nsid},!0),i.forEach(function(e){r.remove(e)});if(t.full_response)return n.photoIdsSent=t.photo_ids,n}function r(n,r){var i=this;return n.nsid=r.getViewer().nsid,e.Promise.all([r.callAPI("flickr.photos.setPerms",n),r.getModelRegistry("photostream-models")]).then(function(e){return i._processResponse(e,n)},e.FetcherErrorLogger(t))}e.namespace("ModelUpdaters")["flickr-photos-setPerms"]={run:r,_processResponse:n}},"@VERSION@",{requires:["flickr-promise"]});
YUI.add("flickr-photos-setMeta-updater",function(e,t){"use strict";function n(n,r){var i={};return n.fullResponse?(i.full_response=1,i.photo_ids=n.photoId):i.photo_id=n.photoId,typeof n.title!="undefined"&&(i.title=n.title),typeof n.description!="undefined"&&(i.description=n.description),e.Promise.all([r.callAPI("flickr.photos.setMeta",i),r.getModelRegistry("photo-models")]).then(function(t){var r=t[0],i=t[1];if(n.fullResponse){if("errors"in r)return r.api="setMeta",r}else{if(!i.exists(n.photoId))throw new Error("[flickr-photos-setMeta-updater] - Photo model can not be updated if it does not exist");!r.photo||!r.photo.title||!r.photo.description?e.Flog.warn("[flickr-photos-setMeta-updater] - No updated data returned from API."):i.setValues(n.photoId,{title:r.photo.title.content,description:r.photo.description.content})}},function(e){throw n.fullResponse&&(e.photoIds=n.photoId,e.returnApi="setMeta"),e}).then(null,e.FetcherErrorLogger(t))}e.namespace("ModelUpdaters")["flickr-photos-setMeta"]={run:n}},"@VERSION@",{requires:["flickr-promise","flog"],optional:[]});
YUI.add("flickr-photos-licenses-setLicense-updater",function(e,t){"use strict";function n(n,r){var i={};return n.fullResponse?(i.photo_ids=n.photoId,i.full_response=1):i.photo_id=n.photoId,i.license_id=n.license,r.callAPI("flickr.photos.licenses.setLicense",i).then(function(e){if("errors"in e)return e.api="setLicense",e},function(e){throw n.fullResponse&&(e.photoIds=n.photoId,e.returnApi="setLicense"),e}).then(null,e.FetcherErrorLogger(t))}e.namespace("ModelUpdaters")["flickr-photos-licenses-setLicense"]={run:n}},"@VERSION@",{requires:["flickr-promise"]});
YUI.add("flickr-photos-setSafetyLevel-updater",function(e,t){"use strict";function n(n,r){var i={};return n.fullResponse?(i.photo_ids=n.photoId,i.full_response=1):i.photo_id=n.photoId,i.safety_level=n.safetyLevel+1,r.callAPI("flickr.photos.setSafetyLevel",i).then(function(e){if("errors"in e)return e.api="setSafety",e},function(e){throw n.fullResponse&&(e.photoIds=n.photoId,e.returnApi="setSafety"),e}).then(null,e.FetcherErrorLogger(t))}e.namespace("ModelUpdaters")["flickr-photos-setSafetyLevel"]={run:n}},"@VERSION@",{requires:["flickr-promise"]});
YUI.add("photo-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){return e.ModelFetchers["flickr-photos-getInfo"].run(t,this.appContext)},update:function(t,n){var r=[];return("title"in n||"description"in n)&&r.push(e.ModelUpdaters["flickr-photos-setMeta"].run({photoId:t,title:n.title?n.title.newVal:this.getValue(t,"title"),description:n.description?n.description.newVal:this.getValue(t,"description")},this.appContext)),"license"in n&&r.push(e.ModelUpdaters["flickr-photos-licenses-setLicense"].run({photoId:t,license:n.license.newVal},this.appContext)),"safetyLevel"in n&&r.push(e.ModelUpdaters["flickr-photos-setSafetyLevel"].run({photoId:t,safetyLevel:n.safetyLevel.newVal},this.appContext)),e.Promise.all(r)},batchUpdate:function(t,n){var r=[];return"safetyLevel"in n&&r.push(e.ModelUpdaters["flickr-photos-setSafetyLevel"].run({photoId:t,safetyLevel:parseInt(n.safetyLevel,10),fullResponse:1},this.appContext)),"title"in n&&"description"in n?r.push(e.ModelUpdaters["flickr-photos-setMeta"].run({photoId:t,title:n.title,description:n.description,fullResponse:1},this.appContext)):"title"in n?r.push(e.ModelUpdaters["flickr-photos-setMeta"].run({photoId:t,title:n.title,fullResponse:1},this.appContext)):"description"in n&&r.push(e.ModelUpdaters["flickr-photos-setMeta"].run({photoId:t,description:n.description,fullResponse:1},this.appContext)),"license"in n&&r.push(e.ModelUpdaters["flickr-photos-licenses-setLicense"].run({photoId:t,license:n.license,fullResponse:1},this.appContext)),e.Promise.all(r)}},getLargestSize:e.PhotoModelHelper.getLargestSize,getSizeToFit:e.PhotoModelHelper.getSizeToFit,getSizeIfExact:e.PhotoModelHelper.getSizeIfExact,isSizeSquare:e.PhotoModelHelper.isSizeSquare,isPhotoSquare:e.PhotoModelHelper.isPhotoSquare,getGuestpass:function(t){var n=this;return new e.Promise(function(e,r){n.getValue(t,"guestpass")?e():n.appContext.callAPI("flickr.sharing.createGuestpass",{photo:t}).then(function(r){n.setValue(t,"guestpass",r.guestpass.url),e()})})},attributes:{title:e.PhotoModelHelper.attributes.title,description:e.PhotoModelHelper.attributes.description,mediaType:e.PhotoModelHelper.attributes.mediaType,license:e.PhotoModelHelper.attributes.license,isVideo:e.PhotoModelHelper.attributes.isVideo,isOwner:e.PhotoModelHelper.attributes.isOwner,sizes:e.PhotoModelHelper.attributes.sizes,descendingSizes:e.PhotoModelHelper.attributes.descendingSizes,ascendingSizes:e.PhotoModelHelper.attributes.ascendingSizes,aspectRatio:e.PhotoModelHelper.attributes.aspectRatio,needsInterstitial:e.PhotoModelHelper.attributes.needsInterstitial,canComment:e.PhotoModelHelper.attributes.canComment,canPublicComment:e.PhotoModelHelper.attributes.canPublicComment,url:e.PhotoModelHelper.attributes.url,rotation:e.PhotoModelHelper.attributes.rotation,owner:{isModel:!0},engagement:{isModel:!0},isHD:{},secret:{},canAddMeta:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!0},isMarketplacePrintable:{defaultFn:function(e){return!1}},isMarketplaceLicensable:e.PhotoModelHelper.attributes.isMarketplaceLicensable,marketplaceLicensingUrl:e.PhotoModelHelper.attributes.marketplaceLicensingUrl,oWidth:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)},defaultValue:0},oHeight:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)},defaultValue:0},safetyLevel:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)}},guestpass:{},hasInvalidColorspaceForPrint:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},sizesForAlbum:{readOnly:!0,derivedBy:["sizes"],defaultFn:function(t){var n=this.getValue(t,"sizes");return e.Object.each(n,function(e,t){e.src=e.url}),n}},curation:{isModel:!0},visibilitySource:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)},defaultValue:1}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-promise","photo-model-helper","photo-curation-models","flickr-photos-getInfo-fetcher","flickr-photos-setPerms-updater","flickr-photos-setMeta-updater","flickr-photos-licenses-setLicense-updater","flickr-photos-setSafetyLevel-updater","attribute-helpers"]});
YUI.add("flickr-groups-pools-getContext-fetcher",function(e,t){"use strict";function n(t){var n={photo_id:t.photoId,extras:e.APIHelper.request.getRebootPhotoExtras()+",datecreate",num_prev:t.numNext,num_next:t.numPrev,get_group_info:1};if(t.id)n.group_id=t.id;else{if(!t.pathAlias)throw new Error("[flickr-groups-pools-getPhotos-fetcher] `id` or `pathAlias` is required.");n.group_path_alias=t.pathAlias}return n}function r(t,n){var r=t[0],i=t[1],s=t[2],o=t[3],u=t[4],a=t[5],f=t[6],l=[],c=[],h=s.proxy(n.photoId),p,d,v,m,g,y,b=[];return p=r.prevphotos,d=r.nextphotos,c=e.APIHelper.response.parsePhotos({photos:p.photo,personModelRegistry:o,photoModelRegistry:s,photoEngagementModelRegistry:u,photoStatsModelRegistry:a,photoCurationModelRegistry:f}),l=e.APIHelper.response.parsePhotos({photos:d.photo,personModelRegistry:o,photoModelRegistry:s,photoEngagementModelRegistry:u,photoStatsModelRegistry:a,photoCurationModelRegistry:f}),y=i.getValue(n.id,"photoContextList"),m=y.hasMinBoundary?y.hasMinBoundary():!1,g=y.hasMaxBoundary?y.hasMaxBoundary():!1,v=y.getList(),b=e.APIHelper.response.addOrReplaceListByContext({model:h,next:c,prev:l.reverse(),current:v,hasMin:m,hasMax:g,numNext:n.numNext,numPrev:n.numPrev}),i.setValue(n.id,"photoContextList",b),{next:c,previous:l.reverse()}}function i(n,r){var i=this;return e.Promise.all([r.callAPI("flickr.groups.pools.getContext",this._processParams(n),!0),r.getModelRegistry("group-pool-models"),r.getModelRegistry("photo-models"),r.getModelRegistry("person-models"),r.getModelRegistry("photo-engagement-models"),r.getModelRegistry("photo-stats-models"),r.getModelRegistry("photo-curation-models")]).then(function(e){return i._processResponse(e,n)},function(e){throw e.code===2&&e.message==="Photo not in pool"&&(e.notInContext=!0),e}).then(null,e.FetcherErrorLogger(t))}e.namespace("ListFetchers")["flickr-groups-pools-getContext"]={run:i,_processParams:n,_processResponse:r}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["photo-models","photo-engagement-models","photo-stats-models","group-models","photo-curation-models"]});
YUI.add("flickr-groups-pools-add-creator",function(e,t){"use strict";function n(t){var n={photo_id:t.photoID,group_id:e.Models["group-pool-models"].extractGroupFromCompoundId(t.groupID)};return n}function r(e,t){var n=e.apiResponse,r=e.groupPoolModel,i=e.photoModel,s=e.photoGroupsModelRegistry,o=e.photoContextsModelRegistry,u=e.unfilteredGroupPoolModel;if(n.stat==="ok")return r&&!r.hasPhoto(i.getValue("id"))&&(r.addPhotoLocal(i),r.getValue("group").setValue("poolCount",r.getValue("group").getValue("poolCount")+1)),u&&u.hasPhoto(i.getValue("id"))&&u.addPhotoLocal(i),s.exists(t.photoID)&&!s.getValue(t.photoID,"groups").getFromListByID(t.unfilteredGroupId)&&(s.getValue(t.photoID,"groups").unshift(r),s.setValue(t.photoID,"total",s.getValue(t.photoID,"total")+1)),o.exists(t.photoID)&&!o.getValue(t.photoID,"contexts").getFromListByID(t.unfilteredGroupId)&&(o.setValue(t.photoID,"totalGroups",o.getValue(t.photoID,"totalGroups")+1),o.getValue(t.photoID,"contexts").push(r)),r}function i(n,r){var i=this,s=this._processParams(n),o=n.registryName||"group-pool-models",u={apiResponse:r.callAPI("flickr.groups.pools.add",s),groupPoolModel:r.getModel(o,n.groupID),photoModel:r.getModel("photo-models",n.photoID),photoGroupsModelRegistry:r.getModelRegistry("photo-groups-models"),photoContextsModelRegistry:r.getModelRegistry("photo-contexts-models")};return n.unfilteredGroupId=s.group_id,o!=="group-pool-models"&&(u.unfilteredGroupPoolModel=r.getModel("group-pool-models",n.unfilteredGroupId)),(new e.FlickrPromise(u)).then(function(e){return i._processResponse(e,n)},e.FetcherErrorLogger(t))}e.namespace("ModelCreators")["flickr-groups-pools-add"]={run:i,_processParams:n,_processResponse:r}},"@VERSION@",{requires:["flickr-promise","group-pool-models"],optional:[]});
YUI.add("flickr-groups-pools-remove-deletor",function(e,t){"use strict";function n(t){var n={photo_id:t.photoID,group_id:e.Models["group-pool-models"].extractGroupFromCompoundId(t.groupID)};return n}function r(e,t){var n=e.apiResponse,r=e.groupPoolModelRegistry,i=e.photoModelRegistry,s=e.photoGroupsModelRegistry,o=e.photoContextsModelRegistry,u=e.unfilteredGroupPoolModelRegistry;if(n.stat==="ok")return o.exists(t.photoID)&&o.getValue(t.photoID,"contexts").getFromListByID(t.unfilteredGroupId)&&(o.setValue(t.photoID,"totalGroups",o.getValue(t.photoID,"totalGroups")-1),o.getValue(t.photoID,"contexts").removeFromList(t.unfilteredGroupId)),s.exists(t.photoID)&&s.getValue(t.photoID,"groups").getFromListByID(t.unfilteredGroupId)&&(s.setValue(t.photoID,"total",s.getValue(t.photoID,"total")-1),s.getValue(t.photoID,"groups").removeFromList(t.unfilteredGroupId)),r&&(r.hasPhoto(i.getValue("id"))&&r.removePhotoLocal(i),r.getValue("group").setValue("poolCount",r.getValue("group").getValue("poolCount")-1)),u&&u.hasPhoto(i.getValue("id"))&&u.removePhotoLocal(i),r}function i(n,r){var i=this,s=this._processParams(n),o=n.registryName||"group-pool-models",u={apiResponse:r.callAPI("flickr.groups.pools.remove",s),groupPoolModelRegistry:r.getModel(o,n.groupID),photoModelRegistry:r.getModel("photo-models",n.photoID),photoGroupsModelRegistry:r.getModelRegistry("photo-groups-models"),photoContextsModelRegistry:r.getModelRegistry("photo-contexts-models")};return n.unfilteredGroupId=s.group_id,o!=="group-pool-models"&&(u.unfilteredGroupPoolModelRegistry=r.getModel("group-pool-models",n.unfilteredGroupId)),(new e.FlickrPromise(u)).then(function(e){return i._processResponse(e,n)},e.FetcherErrorLogger(t))}e.namespace("ModelDeletors")["flickr-groups-pools-remove"]={run:i,_processParams:n,_processResponse:r}},"@VERSION@",{requires:["flickr-promise","group-pool-models"],optional:[]});
YUI.add("flickr-groups-invite-photo-invite-creator",function(e,t){"use strict";function n(n,r){var i={},s=e.Models["group-pool-models"].extractGroupFromCompoundId(n.groupID);return i.photo_id=n.photoID,i.group_id=s,e.Promise.all([r.callAPI("flickr.groups.invite.photo.invite",i),r.getModel("group-pool-models",s),r.getModelRegistry("photo-group-invitation-models"),r.getModelRegistry("photo-group-invitations-models")]).then(function(e){var t=e[0],i=e[1],o=e[2],u=e[3],a,f,l;if(t.stat==="ok")return a=[n.photoID,s].join("-"),f={id:a,photoId:n.photoID,groupId:s,invitedBy:r.getViewer().nsid},l=o.exists(a)?o.proxy(a):o.add(f),u.exists(n.photoID)&&!u.getValue(n.photoID,"invitations").getFromListByID(a)&&(u.getValue(n.photoID,"groups").prependToList(i),u.getValue(n.photoID,"invitations").prependToList(l),u.setValue(n.photoID,"total",u.getValue(n.photoID,"total")+1)),i},e.FetcherErrorLogger(t))}e.namespace("ModelCreators")["flickr-groups-invite-photo-invite"]={run:n}},"@VERSION@",{requires:["flickr-promise","group-pool-models"],optional:[]});
YUI.add("flickr-groups-invite-photo-cancel-deletor",function(e,t){"use strict";function n(n,r){var i={},s=e.Models["group-pool-models"].extractGroupFromCompoundId(n.groupID);return i.photo_id=n.photoID,i.group_id=s,e.Promise.all([r.callAPI("flickr.groups.invite.photo.cancel",i),r.getModel("group-pool-models",s),r.getModelRegistry("photo-group-invitation-models"),r.getModelRegistry("photo-group-invitations-models")]).then(function(e){var t=e[0],r=e[1],i=e[2],o=e[3],u;if(t.stat==="ok")return u=[n.photoID,s].join("-"),o.exists(n.photoID)&&o.getValue(n.photoID,"invitations").getFromListByID(u)&&(o.setValue(n.photoID,"total",o.getValue(n.photoID,"total")-1),o.getValue(n.photoID,"groups").removeFromList(s),o.getValue(n.photoID,"invitations").removeFromList(u)),i.remove(u),r},e.FetcherErrorLogger(t))}e.namespace("ModelDeletors")["flickr-groups-invite-photo-cancel"]={run:n}},"@VERSION@",{requires:["flickr-promise","group-pool-models"],optional:[]});
YUI.add("group-pool-by-person-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.Models["group-pool-models"],{name:this.name,attributes:e.merge(e.Models["group-pool-models"].prototype.attributes,{personFilter:{validator:function(t,n){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)},defaultValue:null}})})},"@VERSION@",{requires:["attribute-helpers","group-pool-models","flickr-groups-pools-getPhotos-fetcher","flickr-groups-pools-add-creator","flickr-groups-pools-remove-deletor","flickr-groups-invite-photo-invite-creator","flickr-groups-invite-photo-cancel-deletor"]});
YUI.add("group-pool-by-tag-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.Models["group-pool-models"],{name:this.name,attributes:{tagFilter:{validator:function(t,n){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)},defaultValue:null}}})},"@VERSION@",{requires:["attribute-helpers"]});
YUI.add("flickr-groups-pools-getPhotos-fetcher",function(e,t){"use strict";function n(t){var n={extras:e.APIHelper.request.getRebootPhotoExtras()+","+e.APIHelper.request.getRebootGroupExtras(),per_page:t.perPage||20,page:t.page||1,get_group_info:1};if(t.id)n.group_id=e.Models["group-pool-models"].extractGroupFromCompoundId(t.id);else{if(!t.pathAlias)throw new Error("[flickr-groups-pools-getPhotos-fetcher] `id` or `pathAlias` is required.");n.group_path_alias=t.pathAlias}return t.withPhotoId&&(n.jump_to=t.withPhotoId),t.privacyFilter&&(n.privacy_filter=t.privacyFilter),t.safeSearch&&(n.safe_search=t.safeSearch),t.media&&(n.media=t.media),t.personFilter&&(n.user_id=t.personFilter),t.tagFilter&&(n.tags=t.tagFilter),n}function r(t,n){var r=t.apiResponse,i=t.photoModelRegistry,s=t.personModelRegistry,o=t.groupPoolModelRegistry,u=t.groupPoolByPersonModelRegistry,a=t.groupPoolByTagModelRegistry,f=t.photoEngagementModelRegistry,l=t.photoStatsModelRegistry,c=t.photoCurationModelRegistry,h=t.groupModelRegistry,p,d,v,m;return r.group.pathAlias=r.group.pathalias===""?null:r.group.pathalias,p=h.parseGroupModel(r.group.nsid,r.group.pathAlias,r.group),h.addOrUpdate(p),d={pathAlias:r.group.pathAlias,group:h.proxy(p.id),filteredPoolCount:r.group.poolCount},v=e.APIHelper.response.parsePhotos({photos:r.photos.photo,personModelRegistry:s,photoModelRegistry:i,photoEngagementModelRegistry:f,photoStatsModelRegistry:l,photoCurationModelRegistry:c}),d.photoPageList={perPage:r.photos.perpage,page:r.photos.page,pageContent:v,totalItems:d.filteredPoolCount},n.personFilter?(d.id=e.Models["group-pool-models"].buildCompoundId(r.group.nsid,n.personFilter),d.personFilter=n.personFilter,d.filteredPoolCount=d.photoPageList.totalItems=r.photos.total,m=u):n.tagFilter?(d.id=e.Models["group-pool-models"].buildCompoundId(r.group.nsid,n.tagFilter),d.tagFilter=n.tagFilter,d.filteredPoolCount=d.photoPageList.totalItems=r.photos.total,m=a):(n.id&&n.id!==r.group.nsid?d.id=n.id:d.id=r.group.nsid,m=o),m.exists(d.id)?(m.setValue(d.id,"photoPageList",d.photoPageList),m.setValue(d.id,"group",d.group),m.setValue(d.id,"pathAlias",d.pathAlias),m.setValue(d.id,"filteredPoolCount",parseInt(d.filteredPoolCount,10)||0),d.group.setValue("poolCount",parseInt(r.group.poolCount,10)||0)):m.add(d),v}function i(n,r){var i=this,s=this._processParams(n),o={apiResponse:r.callAPI("flickr.groups.pools.getPhotos",s,!0),photoModelRegistry:r.getModelRegistry("photo-models"),personModelRegistry:r.getModelRegistry("person-models"),groupPoolModelRegistry:r.getModelRegistry("group-pool-models"),photoEngagementModelRegistry:r.getModelRegistry("photo-engagement-models"),photoStatsModelRegistry:r.getModelRegistry("photo-stats-models"),photoCurationModelRegistry:r.getModelRegistry("photo-curation-models"),groupModelRegistry:r.getModelRegistry("group-models")};return n.personFilter&&(o.groupPoolByPersonModelRegistry=r.getModelRegistry("group-pool-by-person-models")),n.tagFilter&&(o.groupPoolByTagModelRegistry=r.getModelRegistry("group-pool-by-tag-models")),(new e.FlickrPromise(o)).then(function(e){return i._processResponse(e,n)},e.FetcherErrorLogger(t))}e.namespace("ListFetchers")["flickr-groups-pools-getPhotos"]={run:i,_processParams:n,_processResponse:r}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["photo-models","person-models","photo-engagement-models","photo-stats-models","group-models","group-pool-models","group-pool-by-person-models","group-pool-by-tag-models","photo-curation-models"]});
YUI.add("group-contributor-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,attributes:{nsid:{validator:function(t,n){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)}},dateJoined:{validator:function(t){return e.AttributeHelpers.validateDate(t)},setter:function(t){return e.AttributeHelpers.coerceDate(t)},serialize:function(e){return e.format("X")},deserialize:function(t){return e.moment(t,"X")}},groupDiscussionCount:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)},defaultValue:0},groupPhotoCount:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)},defaultValue:0},pathAlias:{validator:function(t,n){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)}},rank:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)}},realname:{validator:function(t,n){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)}},username:{validator:function(t,n){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)}},latestPhotoId:{validator:function(t,n){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)}},latestPhotoTitle:{validator:function(t,n){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)}},avatarUrl:{validator:function(t,n){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)}},latestPhotoUrl:{readOnly:!0,derivedBy:["contributorUrl","latestPhotoId"],getter:function(e,t){return this.getValue(t,"latestPhotoId")?this.getValue(t,"contributorUrl")+this.getValue(t,"latestPhotoId")+"/":!1}},displayname:{readOnly:!0,derivedBy:["username"],getter:function(e,t){return this.getValue(t,"username")}},contributorUrl:{readOnly:!0,derivedBy:["id","pathAlias"],getter:function(e,t){return"/photos/"+(this.getValue(t,"pathAlias")||this.getValue(t,"nsid"))+"/"}},isPro:{defaultValue:!1,setter:function(t){return e.AttributeHelpers.coerceBoolean(t)}}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-promise","attribute-helpers"]});
YUI.add("flickr-groups-getTopContributors-fetcher",function(e,t){"use strict";function n(e){var t={group_id:e.id,type:"all",extras:"include_viewer,is_pro"};return t}function r(e,t){var n=e[0],r=e[1],s=e[2],o,u,a;return u={photoContributors:[],discussionContributors:[],id:t.id},n&&n.contributors&&[{k:"photos",v:"photoContributors"},{k:"discussions",v:"discussionContributors"}].forEach(function(e){n.contributors[e.k]&&(o=n.contributors[e.k],o.contributor&&o.contributor.forEach(function(n){a=i(n,t.id),u[e.v].push(s.addOrUpdate(a))}))}),n&&n.viewer&&n.viewer.length!==0?(a=i(n.viewer,t.id),u.viewer=s.addOrUpdate(a)):u.viewer=null,r.addOrUpdate(u),r.proxy(u.id)}function i(t,n){var r={id:t.id+"-"+n,nsid:t.id,dateJoined:t.dateJoined?e.moment(t.dateJoined.toString(),"X"):e.moment(),groupDiscussionCount:t.groupDiscussionCount,groupPhotoCount:t.groupPhotoCount,pathAlias:t.pathAlias,rank:t.rank,realname:t.realname,username:t.username,isPro:t.isPro,avatarUrl:e.URLHelper.getBuddyIconURL(t.id,t.iconfarm,t.iconserver)};return t.latestPhoto&&(r.latestPhotoId=t.latestPhoto.id,r.latestPhotoTitle=t.latestPhoto.name),r}function s(n,r){var i=this;return e.Promise.all([r.callAPI("flickr.groups.getTopContributors",this._processParams(n),!0),r.getModelRegistry("group-top-contributors-models"),r.getModelRegistry("group-contributor-models")]).then(function(e){return i._processResponse(e,n)},e.FetcherErrorLogger(t))}e.namespace("ModelFetchers")["flickr-groups-getTopContributors"]={run:s,_processParams:n,_processResponse:r}},"@VERSION@",{requires:["flickr-promise","api-helper","moment","url-helper"],optional:["group-top-contributors-models","group-contributor-models"]});
